世界の見方（カメラ操作）

デフォルトでは、負の z 軸に沿って部屋の中央に向かっています。 
3D ゲームでは、世界の見方を変えたいと思うことがよくあります。
たとえば、一人称シューティングゲームでは、xy 平面に沿って xy 平面の少し上の位置からカメラを見たいと思うでしょう。
グラフィック用語では、正しい投影を設定しています。
見た目を変えるには、次の 2 つの機能があります。

・d3d_set_projection(xfrom,yfrom,zfrom,xto,yto,zto,xup,yup,zup) 
　世界の見方を定義します。
　見るポイント、見られるポイント、およびアップ ベクトルを指定します。

この関数には説明が必要です。
投影を設定するには、最初に見ている位置が必要です。
これは、パラメーター (xfrom、yfrom、zfrom) によって示されます。

次に、見る方向を指定する必要があります。
これは、2 つ目のポイントを指定することによって行われます。
これが点 (xto,yto,zto) です。

最後に、視点から視点への線を中心にカメラを回転させることもできます。
これを指定するには、アップ ベクトル、つまりカメラで上向きの方向を指定する必要があります。
これは、最後の 3 つのパラメーター (xup、yup、zup) によって指定されます。



例を挙げましょう。
一人称シューティングゲームのようにxy平面に沿って見るには、使用できます

　d3d_set_projection(100,100,10,200,100,10,0,0,1);

つまり、点 (100,100) と 10 平面から (200,100) の方向を見ます。
アップ ベクトル ポイントは、必要に応じて z 方向です。

これを少し複雑にするために、部屋にカメラの位置を指定するインスタンスがあるとします。
現在の (x,y) 位置と方向 (場合によっては速度) が含まれます。

次のコードを使用して、これをカメラとして指定できるようになりました。

　with (obj_camera){
  　d3d_set_projection(x,y,10,x+cos(direction*pi/180),y-sin(direction*pi/180),10,0,0,1);
　}

これは少し複雑に見えるかもしれません。
カメラの位置 (x,y)、地上 10 から見ています。

正しい方向のポイントを決定するには、少し計算する必要があります。
この点は、次の 3 つのパラメーターによって示されます。

最後に、上記のようにアップ ベクトルを使用します。



1つの重要な発言！ 
Game Maker が部屋の描画を開始すると、視点がデフォルトの位置に戻されます。
したがって、シーンの描画が設定されたときに最初に行う必要があるのは、必要な投影にすることです。

これは、描画イベントで行う必要があります。
上記の関数の拡張バージョンもあります。

・d3d_set_projection_ext(xfrom,yfrom,zfrom,xto,yto,zto,xup,yup,zup,angle,aspect,znear,zfar) 
　この関数の拡張バージョンで、視野を定義する角度、アスペクト比も指定します
　ビューの水平サイズと垂直サイズの間、およびニア クリッピング プレーンとファー クリッピング プレーン。



追加のパラメーターは次のように機能します。

カメラの位置、注視点、およびアップ ベクトルを指定した場合でも、カメラのレンズの幅を変更できます。

これを視野と呼びます。
妥当な値は 40 ～ 45 度の間です。
ただし、必要に応じてこれを変更できます。

次に、水平投影と垂直投影の縦横比を指定できます。

通常、部屋またはビューの縦横比と同じものを使用します。800/608 or 800/600。

最後に、クリッピング プレーンを指定できます。 

znear よりもカメラに近いオブジェクトは描画されません。 
zfar よりも遠いオブジェクトについても同様です。

これらのパラメーターは z 比較の精度にも影響するため、適切な値に設定することが重要になる場合があります。
範囲を大きくしすぎると、精度が悪くなります。
デフォルトでは 1 と 32000 を使用します。

znear は 0 より大きくなければなりません!



3D がない場合に使用される通常の正射投影が一時的に必要になる場合があります。
または、デフォルトの透視投影に戻したい。

これには、次の関数を使用できます。

・d3d_set_projection_ortho(x,y,w,h,angle) 
　部屋の指定された領域の通常の正投影を、指定された角度で回転させて設定します。

・d3d_set_projection_perspective(x,y,w,h,angle) 
　部屋の指定された領域の通常の透視投影を、指定された角度で回転させて設定します。



これの標準的な使用法は、オーバーレイを描画することです。
スコアまたはその他の側面を表示します。

そのために、正投影を設定します。

また、現在の深さの値に関係なく情報を描画する必要があるため、
隠面の削除を一時的にオフにする必要があります。

次の例は、スコアでオーバーレイを作成する方法を示しています。

  draw_set_color(c_black);
  d3d_set_projection_ortho(0,0,room_width,room_height,0);
  d3d_set_hidden(false);
  draw_text(10,10,'Score: ' + string(score));
  d3d_set_hidden(true);


